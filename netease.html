<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>网易云音乐 - 公共API版</title>
    
    <!-- 图标和字体 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* 重置和基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: white;
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }
        
        /* 容器 */
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* 头部 */
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-top: 10px;
        }
        
        .logo {
            font-size: 2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .logo i {
            color: #e60026;
        }
        
        .tagline {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        /* 搜索栏 */
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 20px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            outline: none;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .search-btn {
            padding: 12px 25px;
            border-radius: 25px;
            background: linear-gradient(135deg, #e60026, #ff4d4d);
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 0, 38, 0.3);
        }
        
        /* 分类标签 */
        .categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
        }
        
        .categories::-webkit-scrollbar {
            display: none;
        }
        
        .category-btn {
            padding: 8px 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .category-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .category-btn.active {
            background: linear-gradient(135deg, #e60026, #ff4d4d);
            color: white;
            border-color: transparent;
        }
        
        /* 播放器 */
        .player-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .album-art {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .album-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .album-art.playing img {
            animation: rotateAlbum 20s linear infinite;
        }
        
        @keyframes rotateAlbum {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .track-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .track-title {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .track-artist {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        /* 进度条 */
        .progress-container {
            margin-bottom: 15px;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-bottom: 5px;
            overflow: hidden;
            cursor: pointer;
        }
        
        .progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #e60026, #ff4d4d);
            border-radius: 2px;
            transition: width 0.1s linear;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* 控制按钮 */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .play-btn {
            width: 55px;
            height: 55px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #e60026, #ff4d4d);
            border: none;
        }
        
        /* 音量控制 */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .volume-slider {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            cursor: pointer;
            background: #e60026;
        }
        
        /* 播放列表 */
        .playlist {
            margin-top: 20px;
        }
        
        .playlist-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .playlist-items {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 10px;
        }
        
        .playlist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .playlist-item.active {
            background: rgba(230, 0, 38, 0.15);
            border-left: 3px solid #e60026;
        }
        
        .playlist-item img {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            object-fit: cover;
        }
        
        .playlist-info {
            flex: 1;
            min-width: 0;
        }
        
        .playlist-info h4 {
            font-size: 0.95rem;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .playlist-info p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .playlist-duration {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* 歌词容器 */
        .lyrics-container {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            display: none;
        }
        
        .lyrics-title {
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .lyrics {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            text-align: center;
        }
        
        .lyrics-line {
            margin-bottom: 8px;
            opacity: 0.6;
            transition: all 0.3s ease;
        }
        
        .lyrics-line.active {
            opacity: 1;
            color: #e60026;
            font-weight: 600;
            transform: scale(1.03);
        }
        
        /* 加载更多 */
        .load-more {
            text-align: center;
            margin-top: 15px;
        }
        
        .load-more-btn {
            padding: 10px 25px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .load-more-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* 通知 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
            border-left: 4px solid #e60026;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        /* 加载动画 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #e60026;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 浮动歌词 */
        .floating-lyrics {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 12px 20px;
            color: white;
            font-size: 1rem;
            z-index: 1000;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            display: none;
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .floating-lyrics.show {
            display: block;
            animation: floatIn 0.3s ease;
        }
        
        @keyframes floatIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* 响应式设计 */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .player-card {
                padding: 15px;
            }
            
            .album-art {
                width: 150px;
                height: 150px;
            }
            
            .controls {
                gap: 10px;
            }
            
            .control-btn {
                width: 40px;
                height: 40px;
            }
            
            .play-btn {
                width: 50px;
                height: 50px;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .search-btn {
                width: 100%;
            }
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <div class="logo">
                <i class="fab fa-netease-music"></i>
                <h1>网易云音乐</h1>
            </div>
            <p class="tagline">使用公共API的在线音乐播放器</p>
        </div>
        
        <!-- 搜索栏 -->
        <div class="search-box">
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="搜索歌曲、歌手、专辑...">
                <button class="search-btn" id="searchBtn">
                    <i class="fas fa-search"></i> 搜索
                </button>
            </div>
        </div>
        
        <!-- 分类标签 -->
        <div class="categories">
            <button class="category-btn active" data-type="hot">热门推荐</button>
            <button class="category-btn" data-type="new">新歌上架</button>
            <button class="category-btn" data-type="playlist">精选歌单</button>
            <button class="category-btn" data-type="rank">排行榜</button>
            <button class="category-btn" data-type="chinese">华语流行</button>
            <button class="category-btn" data-type="western">欧美热歌</button>
        </div>
        
        <!-- 播放器 -->
        <div class="player-card">
            <div class="album-art" id="albumArt">
                <img src="https://p2.music.126.net/6y-UleORITEDbvrOLV0Q8A==/5639395138885805.jpg" alt="专辑封面">
            </div>
            
            <div class="track-info">
                <h2 class="track-title" id="trackTitle">选择歌曲开始播放</h2>
                <p class="track-artist" id="trackArtist">-</p>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
            </div>
            
            <div class="controls">
                <button class="control-btn" id="prevBtn" title="上一首">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="control-btn play-btn" id="playBtn" title="播放/暂停">
                    <i class="fas fa-play" id="playIcon"></i>
                </button>
                <button class="control-btn" id="nextBtn" title="下一首">
                    <i class="fas fa-step-forward"></i>
                </button>
                <button class="control-btn" id="lyricsBtn" title="显示/隐藏歌词">
                    <i class="fas fa-music"></i>
                </button>
                <button class="control-btn" id="likeBtn" title="喜欢">
                    <i class="far fa-heart"></i>
                </button>
            </div>
            
            <div class="volume-control">
                <i class="fas fa-volume-up" style="color: #e60026;"></i>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
                <span id="volumePercent" style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.7);">50%</span>
            </div>
            
            <!-- 歌词显示 -->
            <div class="lyrics-container" id="lyricsContainer">
                <h3 class="lyrics-title">
                    <i class="fas fa-music"></i> 歌词
                </h3>
                <div class="lyrics" id="lyrics">
                    歌词加载中...
                </div>
            </div>
        </div>
        
        <!-- 播放列表 -->
        <div class="playlist">
            <h3 class="playlist-title">
                <i class="fas fa-list"></i> 
                <span id="playlistTitle">歌曲列表</span>
                <span id="songCount" style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.5); margin-left: auto;">0首</span>
            </h3>
            
            <div class="playlist-items" id="playlistContainer">
                <!-- 歌曲列表将在这里动态生成 -->
            </div>
            
            <div class="load-more">
                <button class="load-more-btn" id="loadMoreBtn">
                    <i class="fas fa-sync-alt"></i> 加载更多
                </button>
            </div>
        </div>
    </div>
    
    <!-- 浮动歌词 -->
    <div class="floating-lyrics" id="floatingLyrics"></div>
    
    <script>
        // ==================== 配置 ====================
        // 公共API列表（备用）
        const API_SERVICES = [
            'https://netease-cloud-music-api-liart-iota.vercel.app',
            'https://music-api.heiye.work',
            'https://api.injahow.cn/meting',
            'https://music.163.com/api'
        ];
        
        // 当前使用的API索引
        let currentApiIndex = 0;
        
        // 获取当前API地址
        function getApiUrl() {
            return API_SERVICES[currentApiIndex];
        }
        
        // 切换API服务
        function switchApi() {
            currentApiIndex = (currentApiIndex + 1) % API_SERVICES.length;
            console.log(`切换到API: ${getApiUrl()}`);
            showNotification(`切换到备用服务器 ${currentApiIndex + 1}`);
        }
        
        // ==================== 播放器状态 ====================
        let currentPlaylist = [];
        let currentTrackIndex = -1;
        let isPlaying = false;
        let currentLyrics = [];
        let currentPage = 1;
        let currentCategory = 'hot';
        let currentSearchQuery = '';
        
        // ==================== DOM元素 ====================
        const elements = {
            // 播放器元素
            albumArt: document.getElementById('albumArt'),
            trackTitle: document.getElementById('trackTitle'),
            trackArtist: document.getElementById('trackArtist'),
            progressBar: document.getElementById('progressBar'),
            progress: document.getElementById('progress'),
            currentTime: document.getElementById('currentTime'),
            totalTime: document.getElementById('totalTime'),
            playBtn: document.getElementById('playBtn'),
            playIcon: document.getElementById('playIcon'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            lyricsBtn: document.getElementById('lyricsBtn'),
            likeBtn: document.getElementById('likeBtn'),
            volumeSlider: document.getElementById('volumeSlider'),
            volumePercent: document.getElementById('volumePercent'),
            lyricsContainer: document.getElementById('lyricsContainer'),
            lyrics: document.getElementById('lyrics'),
            floatingLyrics: document.getElementById('floatingLyrics'),
            
            // 搜索和列表元素
            searchInput: document.getElementById('searchInput'),
            searchBtn: document.getElementById('searchBtn'),
            playlistContainer: document.getElementById('playlistContainer'),
            loadMoreBtn: document.getElementById('loadMoreBtn'),
            playlistTitle: document.getElementById('playlistTitle'),
            songCount: document.getElementById('songCount'),
            categoryBtns: document.querySelectorAll('.category-btn')
        };
        
        // ==================== 音频对象 ====================
        const audio = new Audio();
        audio.volume = 0.5; // 默认音量50%
        
        // ==================== 工具函数 ====================
        
        // 显示通知
        function showNotification(message, duration = 3000) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <i class="fas fa-info-circle"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // 显示动画
            setTimeout(() => notification.classList.add('show'), 10);
            
            // 自动隐藏
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }
        
        // 格式化时间
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // 加载动画
        function showLoading(show) {
            if (show) {
                elements.playlistContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div class="loading" style="width: 30px; height: 30px;"></div>
                        <p style="margin-top: 10px; color: rgba(255,255,255,0.5);">加载中...</p>
                    </div>
                `;
            }
        }
        
        // ==================== API函数 ====================
        
        // 搜索歌曲
        async function searchSongs(keywords, page = 1, limit = 20) {
            try {
                showLoading(true);
                
                const apiUrl = getApiUrl();
                const response = await fetch(
                    `${apiUrl}/search?keywords=${encodeURIComponent(keywords)}&limit=${limit}&offset=${(page-1)*limit}`
                );
                
                if (!response.ok) throw new Error('网络请求失败');
                
                const data = await response.json();
                
                if (data.code === 200 && data.result) {
                    return data.result.songs || [];
                } else {
                    // 如果失败，切换到下一个API
                    switchApi();
                    return searchSongs(keywords, page, limit);
                }
            } catch (error) {
                console.error('搜索失败:', error);
                showNotification('搜索失败，正在重试...');
                
                // 切换到下一个API
                switchApi();
                return searchSongs(keywords, page, limit);
            } finally {
                showLoading(false);
            }
        }
        
        // 获取歌曲详情
        async function getSongDetails(ids) {
            try {
                const apiUrl = getApiUrl();
                const response = await fetch(`${apiUrl}/song/detail?ids=${ids}`);
                
                if (!response.ok) throw new Error('网络请求失败');
                
                const data = await response.json();
                
                if (data.code === 200 && data.songs) {
                    return data.songs;
                }
                return [];
            } catch (error) {
                console.error('获取歌曲详情失败:', error);
                return [];
            }
        }
        
        // 获取歌曲URL
        async function getSongUrl(id) {
            try {
                const apiUrl = getApiUrl();
                const response = await fetch(`${apiUrl}/song/url?id=${id}`);
                
                if (!response.ok) throw new Error('网络请求失败');
                
                const data = await response.json();
                
                if (data.code === 200 && data.data && data.data[0] && data.data[0].url) {
                    return data.data[0].url;
                }
                
                // 如果获取不到URL，使用备用方案
                return `https://music.163.com/song/media/outer/url?id=${id}.mp3`;
            } catch (error) {
                console.error('获取歌曲URL失败:', error);
                return `https://music.163.com/song/media/outer/url?id=${id}.mp3`;
            }
        }
        
        // 获取歌词
        async function getLyrics(id) {
            try {
                const apiUrl = getApiUrl();
                const response = await fetch(`${apiUrl}/lyric?id=${id}`);
                
                if (!response.ok) throw new Error('网络请求失败');
                
                const data = await response.json();
                
                if (data.code === 200) {
                    const lyricText = data.lrc ? data.lrc.lyric : '';
                    return parseLyrics(lyricText);
                }
                return [];
            } catch (error) {
                console.error('获取歌词失败:', error);
                return [];
            }
        }
        
        // 解析歌词
        function parseLyrics(lyricText) {
            if (!lyricText) return [];
            
            const lines = lyricText.split('\n');
            const lyrics = [];
            const timeRegex = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/;
            
            lines.forEach(line => {
                const match = timeRegex.exec(line);
                if (match) {
                    const minutes = parseInt(match[1]);
                    const seconds = parseInt(match[2]);
                    const milliseconds = parseInt(match[3].length === 2 ? match[3] * 10 : match[3]);
                    const time = minutes * 60 + seconds + milliseconds / 1000;
                    
                    const text = line.replace(timeRegex, '').trim();
                    if (text) {
                        lyrics.push({ time, text });
                    }
                }
            });
            
            lyrics.sort((a, b) => a.time - b.time);
            return lyrics;
        }
        
        // 获取热门歌单
        async function getHotPlaylists(category = '全部', page = 1, limit = 20) {
            try {
                const apiUrl = getApiUrl();
                const response = await fetch(
                    `${apiUrl}/top/playlist?cat=${encodeURIComponent(category)}&limit=${limit}&offset=${(page-1)*limit}`
                );
                
                if (!response.ok) throw new Error('网络请求失败');
                
                const data = await response.json();
                
                if (data.code === 200) {
                    return data.playlists || [];
                }
                return [];
            } catch (error) {
                console.error('获取歌单失败:', error);
                return [];
            }
        }
        
        // 获取排行榜
        async function getTopList() {
            try {
                const apiUrl = getApiUrl();
                const response = await fetch(`${apiUrl}/toplist`);
                
                if (!response.ok) throw new Error('网络请求失败');
                
                const data = await response.json();
                
                if (data.code === 200 && data.list && data.list[0]) {
                    const listId = data.list[0].id;
                    const detailResponse = await fetch(`${apiUrl}/playlist/detail?id=${listId}`);
                    const detailData = await detailResponse.json();
                    
                    if (detailData.code === 200 && detailData.playlist && detailData.playlist.tracks) {
                        return detailData.playlist.tracks;
                    }
                }
                return [];
            } catch (error) {
                console.error('获取排行榜失败:', error);
                return [];
            }
        }
        
        // ==================== 数据加载函数 ====================
        
        // 加载分类数据
        async function loadCategoryData() {
            let songs = [];
            
            switch (currentCategory) {
                case 'hot':
                    songs = await searchSongs('热门歌曲', currentPage, 20);
                    break;
                    
                case 'new':
                    songs = await searchSongs('新歌', currentPage, 20);
                    break;
                    
                case 'playlist':
                    const playlists = await getHotPlaylists('流行', currentPage, 20);
                    renderPlaylists(playlists);
                    return;
                    
                case 'rank':
                    songs = await getTopList();
                    break;
                    
                case 'chinese':
                    songs = await searchSongs('华语流行', currentPage, 20);
                    break;
                    
                case 'western':
                    songs = await searchSongs('欧美', currentPage, 20);
                    break;
                    
                case 'search':
                    songs = await searchSongs(currentSearchQuery, currentPage, 20);
                    break;
            }
            
            // 如果是第一页，替换列表；否则追加
            if (currentPage === 1) {
                currentPlaylist = songs;
            } else {
                currentPlaylist = [...currentPlaylist, ...songs];
            }
            
            renderPlaylist();
            updateSongCount();
        }
        
        // 渲染播放列表
        function renderPlaylist() {
            if (currentPlaylist.length === 0) {
                elements.playlistContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-music" style="font-size: 3rem; margin-bottom: 10px;"></i>
                        <p>暂无歌曲，请搜索或选择分类</p>
                    </div>
                `;
                return;
            }
            
            elements.playlistContainer.innerHTML = currentPlaylist.map((song, index) => `
                <div class="playlist-item ${index === currentTrackIndex ? 'active' : ''}" data-index="${index}">
                    <img src="${song.album?.picUrl || 'https://p2.music.126.net/6y-UleORITEDbvrOLV0Q8A==/5639395138885805.jpg'}" 
                         alt="${song.name}"
                         onerror="this.src='https://p2.music.126.net/6y-UleORITEDbvrOLV0Q8A==/5639395138885805.jpg'">
                    <div class="playlist-info">
                        <h4>${song.name}</h4>
                        <p>${song.artists?.map(a => a.name).join(', ') || '未知歌手'}</p>
                    </div>
                    <div class="playlist-duration">
                        ${formatTime(song.duration ? song.duration / 1000 : 0)}
                    </div>
                </div>
            `).join('');
            
            // 添加点击事件
            document.querySelectorAll('.playlist-item').forEach(item => {
                item.addEventListener('click', () => {
                    const index = parseInt(item.dataset.index);
                    playSong(index);
      
